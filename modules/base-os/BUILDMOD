name='base-os'
type='module'

build_mod() {
    # Setup chroot
    mkdir -pv $ROOTFS/{dev,proc,sys,run}
    mknod -m 600 $ROOTFS/dev/console c 5 1
    mknod -m 666 $ROOTFS/dev/null c 1 3
    mount -v --bind /dev $ROOTFS/dev
    mount -vt devpts devpts $ROOTFS/dev/pts -o gid=5,mode=620
    mount -vt proc proc $ROOTFS/proc
    mount -vt sysfs sysfs $ROOTFS/sys
    mount -vt tmpfs tmpfs $ROOTFS/run

    if [ -h $ROOTFS/dev/shm ]; then
      mkdir -pv $ROOTFS/$(readlink $ROOTFS/dev/shm)
    fi
    
    echo "#"
    echo "# add link"
    echo "#"
    chroot $ROOTFS /tools/bin/bash -c "mkdir /bin && ln -s /bin/bash /bin/sh"

    ## Build linux-api-headers
    do_build_chroot_with_tools $ROOTFS linux-api-headers

    ## Build man-pages
    do_build_chroot_with_tools $ROOTFS man-pages

    ## Build glibc
    do_build_chroot_with_tools $ROOTFS glbic
}